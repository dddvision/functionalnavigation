#summary How to calculate optical flow induced by body motion.

=== Introduction ===

As a camera moves, light rays from the environment slice through a theoretical unit sphere centered at the cameraâ€™s focus, resulting in patterns of light that appear to flow around the sphere.  Given the camera projection equations and the body trajectory, one can predict the induced rotation field and the direction of the translation field.  This section describes how.

=== Algorithm ===

  * Get an image from a camera.
  * Query the image size.
  * Generate coordinates 'x' for each pixel (ex. using meshgrid).
{{{
x = [ 0 0 0 0 0 1 1 1 1 1 2 2 2 2 2 ... ]
    [ 0 1 2 3 4 0 1 2 3 4 0 1 2 3 4 ... ]
}}}
  * Put the pixel coordinates through the inverse camera projection to get ray vectors `c`.
<img src="http://functionalnavigation.googlecode.com/svn/wiki/StandardPerspectiveRays.png">
  * Evaluate the body trajectory at two time instants `ta` and `tb`.
  * Calculate the rotation matrix `M` that represents the camera frame at time `tb` relative to the camera frame at time `ta`.
  * Rotate the ray vectors by pre-multiplying by the transpose of the rotation matrix (ie. `c_new=transpose(M)*c`).
  * Put the new rays `c_new` through the forward camera projection to get new pixel coordinates `x_new`.
  * The rotational flow field is simply the pixel coordinate difference `u=x-x_new`.
<img src="http://functionalnavigation.googlecode.com/svn/wiki/StandardPerspectiveRotation.png">